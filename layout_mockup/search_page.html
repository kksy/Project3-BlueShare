<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Project 3</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css">
	<link rel="stylesheet" href="css/app.css">
</head>
<body>

	<!-- NAV BAR  -->
	<nav class="top-bar" data-topbar role="navigation">
	  <ul class="title-area">
	    <li class="name">
	      <h1><a href="#">My Site</a></h1>
	    </li>
	     <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
	    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
	  </ul>

	  <section class="top-bar-section">
	    <!-- Right Nav Section -->
	    <ul class="right">
	      <li><a href="#">Login</a></li>
	      <li class="active"><a href="#">Create Listing</a></li>
	    </ul>

	    <!-- Left Nav Section -->
	    <ul class="left">
	      <li class="has-form">
				  <div class="row collapse">
				    <div class="large-8 small-9 columns">
				      <input type="text" placeholder="Find Stuff">
				    </div>
				    <div class="large-4 small-3 columns">
				      <a href="#" class="alert button expand">Search</a>
				    </div>
				  </div>
				</li>
	    </ul>
	  </section>
	</nav>

	<!-- GOOGLE MAP -->
  <div class="small-12 large-6 columns">
		<p>map here</p>
  </div>

  <!-- SEARCH RESULTS -->
  <div class="small-12 large-6 columns">
		<h2>Search Results</h2>

		<div class="small-4 columns">image here</div>
	  <div class="small-5 columns">
	  	<a href="#"><h5>Title of the ad</h5></a>
	  	<p>some description</p>
	  </div>
	  <div class="small-3 columns">
	  	<h5>$100</h5>
	  	<p>location</p>
	  </div>
	  <hr>

	  <div class="small-4 columns">image here</div>
	  <div class="small-5 columns">
	  	<a href="#"><h5>Title of the ad</h5></a>
	  	<p>some description</p>
	  </div>
	  <div class="small-3 columns">
	  	<h5>$100</h5>
	  	<p>location</p>
	  </div>
	  <hr>

	  <div class="small-4 columns">image here</div>
	  <div class="small-5 columns">
	  	<a href="#"><h5>Title of the ad</h5></a>
	  	<p>some description</p>
	  </div>
	  <div class="small-3 columns">
	  	<h5>$100</h5>
	  	<p>location</p>
	  </div>
	  <hr>


  </div>

<script>
$.ajax(options).done(function(data){
	_.each(data, function(item){

		var marker = new google.maps.Marker({
			position: {lat: dish.latitude,lng: dish.longitude},
			map: map,
			title: item.title
		});
	});

})

</script>

	<script src='js/underscore.js'></script>
	<script src='js/app.js'></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
	<script>
		$(document).foundation();
	</script>
</body>
</html>



<!-- <div class="searched-items">
  <div id="result-box" class="small-12 large-6 columns">
  	<h2>Search Results</h2>
    <div class="add-result-box">

    <% @result.each do |item| %>
    <div id='cover_image' data-id="<%= item.id%>" class="small-4 columns"></div>
    <div class="small-5 columns">
      <a href="#"><h5><%= item.title %></h5></a>
      <p>$<%= item.item_details %></p>
    </div>
    <div class="small-3 columns">
      <h5>$<%= item.price %></h5>
      <p><%= item.city %></p>
      <p><%= item.loan_status %></p>
    </div>
    <hr>
  <% end %>
  </div>
</div> -->


$(document).ready(function(){
  var map = new google.maps.Map($('.map')[0],{
    zoom:5,
    center: {lat: -37.813155, lng:144.964078}
  });

  var marker = new google.maps.Marker({
      position: {lat: dish.latitude, lng: dish.longitude },
      map: map,
      title: dish.name
    });

  var infoWindow = new google.maps.InfoWindow({map: map});

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      infoWindow.setPosition(pos);
      infoWindow.setContent('Location found.');
      map.setCenter(pos);
    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
      'Error: The Geolocation service failed.' :
      'Error: Your browser doesn\'t support geolocation.');
  }

//     var options = {
//   url: 'http://localhost:3000/api/items',
//   type: 'get',
//   dataType: 'json'
// }


//   $.ajax(options).done(function(data) {
//     items = data;
//     var first_items = items.splice(0, 5);
//     _.each(first_items, function(item){

//     var template = $([
//         "<div class='small-4 columns'>image here</div>",
//         "<div class='small-5 columns'>",
//         " <a href='#'><h5>" + item.title + "</h5></a>",
//         "   <div class='small-3 columns'>",
//         "    <p>" + item.title + "</p>",
//         "    </div>",
//         "    <div class='small-3 columns'>",
//         "   <h5>" + item.price + "</h5>",
//         "   <p>" + item.location + "</p>",
//         "   </div>",
//         "<hr>"
//       ].join("\n"));

//     $('.add-result-box').append(template);
})

// get items
  // var options = {
  //   url: 'http:/localhost:3000/api/items',
  //   type: 'get',
  //   dataType: 'json'
  // };


  // $.ajax(options).done(function(){
  //   $('.map').append('.');
  // })


// var options = {
//   url: 'http://localhost:3000/api/items',
//   type: 'get',
//   dataType: 'json'
// };

// $.ajax(options).done(function(data){
//   _.each(data, function(item){
//     // var lat =
//     // var long =
//       var marker = new google.maps.Marker({
//       position: {lat: -37.8232, lng: 144.9729},
//       map: map,
//       title: item.title
//     });
//   });
// })
// })

//   var options = {
//   url: 'http://localhost:3000/api/items',
//   type: 'get',
//   dataType: 'json'
// }


//   $('.postfix').on('click', function() {
//     // console.log('here')

//     console.log($('.search-input').val())

//     $.ajax(options).done(function(data) {
//     items = data;
//     var first_items = items.splice(0, 5);
//     _.each(first_items, function(item){

//     var template = $([
//         "<div class='small-4 columns'>image here</div>",
//         "<div class='small-5 columns'>",
//         " <a href='#'><h5>" + item.title + "</h5></a>",
//         "   <div class='small-3 columns'>",
//         "    <p>" + item.title + "</p>",
//         "    </div>",
//         "    <div class='small-3 columns'>",
//         "   <h5>" + item.price + "</h5>",
//         "   <p>" + item.location + "</p>",
//         "   </div>",
//         "<hr>"
//       ].join("\n"));

//     $('#result-box').append(template);




//   });
// });
// $.ajax(options).done(function(data){
//   _.each(data, function(item){
//     // var lat =
//     // var long =
//       var marker = new google.maps.Marker({
//       position: {lat: -37.8232, lng: 144.9729},
//       map: map,
//       title: item.title
//     });
//   });
// })
// })

//   var options = {
//   url: 'http://localhost:3000/api/items',
//   type: 'get',
//   dataType: 'json'
// }



// });


  // })

var options1 = {
  url: 'http://localhost:3000/api/item_images',
  type: 'get',
  dataType: 'json'
};

// $.ajax(options1).done(function(data) {

//       $('div #cover_image').each(function(index){
//           var value = $( this ).data('id') 


//         var imageFirst = getObjects(data, 'item_id', String(value))

//         $(this).append("<img src='" +imageFirst[0].image_path +"'>")
//         // image_path
//       });

//     });

function getObjects(obj, key, val) {
    var objects = [];
    for (var i in obj) {
        if (!obj.hasOwnProperty(i)) continue;
        if (typeof obj[i] == 'object') {
            objects = objects.concat(getObjects(obj[i], key, val));
        } else
        //if key matches and value matches or if key matches and value is not passed (eliminating the case where key matches but passed value does not)
        if (i == key && obj[i] == val || i == key && val == '') { //
            objects.push(obj);
        } else if (obj[i] == val && key == ''){
            //only add if the object is not already in the array
            if (objects.lastIndexOf(obj) == -1){
                objects.push(obj);
            }
        }
    }
    return objects;
}

