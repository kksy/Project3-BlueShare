<div class="row top-margin" data-item="id">
  <!-- IMAGES -->
  <div class="medium-8 columns">
    <div class="demo">
      <ul id="lightSlider">
        <% @item.item_images.each do |image| %>
          <% if image[:image_path].nil? %>
            <li data-thumb="<%= image.image_path_backup %>">
              <img src="<%= image.image_path_backup %>" alt="">
            </li>
          <% else %>
            <li data-thumb="<%= image.image_path %>">
              <img src="<%= image.image_path %>" alt="">
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>

  <!-- INFO -->
  <div class="medium-4 columns highlighted-info">
    <h2><%= @item.title %></h2>
    <h4>$<%= @item.price %></h4>
    <p>postcode: <%= @item.city %></p>

    <% if logged_in? %>
    <button class="button <%= @item.loan_status == 'available'? 'success' : 'alert' %> expand round" data-id="<%= @item.id %>">Reserve Item</button>

    <% else %>
    <a href="<%= login_path %>" class="button <%= @item.loan_status == 'available'? 'success' : 'alert' %> expand round" data-id="<%= @item.id %>">Reserve Item</a>
    <% end %>

    <% if logged_in? %>
    <a href="#" data-reveal-id="myModal"><button class="button expand round">Contact</button></a>

    <% else %>
    <a href="#" data-reveal-id="myModal"><button class="button expand round">Contact</button></a>

    <div id="myModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <h2 id="modalTitle">Not logged in</h2>
     <p class="lead">If you are a user than please login first.</p>
     <p class="lead">If not a user than please signup.</p>
    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>
    <% end %>

  </div>
  </div>
</div>

<hr>
<div class=" row">
  <div class="item-details medium-8 columns">
    <p><%= @item.item_details %></p>
  </div>
</div>

<div id="myModal" class="reveal-modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
  <h2 id="modalTitle">Contact Form</h2>
  <%= form_for :mail  do |f| %>
    Name: <%= f.text_field :name, required: true %>
    Email: <%= f.text_field :email, required: true %>
    Message: <%= f.text_area :message, required: true%>

    <%= f.submit 'Send Message', class: "button success round" %>
  <% end %>
  <a class="close-reveal-modal" aria-label="Close">&#215;</a>
</div>

<script>
  $('.success').on('click',function(){
    var itemId= $(this).data('id');
    $(this).toggleClass('success alert');
    var that = this;
    var options = {
      url: '/api/items/'+itemId,
      type: 'put' ,
      // contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
      dataType: 'json' ,
      data: {loan_status: "reserved"}
    };

    $.ajax(options).done(function(data){
      console.log(data);
      $(that).text('Reserved');
    });
  });

  $('.alert').on('click',function(){
    $(this).toggleClass('alert success');
    var that = this;
    var itemId= $(this).data('id');
    var options = {
      url: '/api/items/'+itemId,
      type: 'put',
      // contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
      dataType: 'json' ,
      data: {loan_status: "available"}
    };

    $.ajax(options).done(function(data){
      $(that).text('Reserve It');
    });
  });
</script>

<!-- <#%= form_tag 'action="/email/<%#= @item.id %>"', method: 'post' do %> -->
  <!-- <label for="">Name</label>
  <input name="name">
  <label>Email</label>
  <input type="text" name='email'>
  <label for="">Message</label>
  <textarea name="body" rows="8" cols="40"></textarea>
  <button class="button success round">Send It</button>
<#% end %> -->
